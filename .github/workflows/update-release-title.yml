name: Update Release Title

on:
  workflow_call:

jobs:
  update-title:
    runs-on: ubuntu-latest
    steps:
      - name: Download dist-manifest.json artifact
        uses: actions/download-artifact@v4
        with:
          name: artifacts-plan-dist-manifest
          path: .
      
      - name: Update announcement_title in dist-manifest.json
        run: |
          # Read the manifest
          if [ ! -f plan-dist-manifest.json ]; then
            echo "Error: plan-dist-manifest.json not found"
            exit 1
          fi
          
          # Extract current announcement_title and modify it
          # The format should be "DisFork v{VERSION}" instead of "{VERSION} (DATE)"
          jq '.announcement_title as $title |
              if $title then
                # Extract version from the title (removes date part if present)
                ($title | split(" ")[0]) as $version |
                .announcement_title = "DisFork v\($version)"
              else
                .
              end' plan-dist-manifest.json > plan-dist-manifest-updated.json
          
          # Replace the original file
          mv plan-dist-manifest-updated.json plan-dist-manifest.json
          
          # Show the change
          echo "Updated announcement_title:"
          jq -r '.announcement_title' plan-dist-manifest.json
      
      - name: Upload updated dist-manifest.json
        uses: actions/upload-artifact@v4
        with:
          name: artifacts-plan-dist-manifest
          path: plan-dist-manifest.json
          overwrite: true
